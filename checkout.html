<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Registry | Clarinbridge Publishing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .serif { font-family: 'Playfair Display', serif; }
        .bg-boutique { background-color: #FCFAF7; }
        .gold-text { color: #C2B280; }
        
        @media (min-width: 1024px) {
            .sync-box {
                display: flex;
                flex-direction: column;
                height: 100%;
                justify-content: space-between; 
            }
        }
    </style>
</head>
<body class="bg-boutique text-gray-900 min-h-screen">

    <header class="w-full bg-white border-b border-gray-100">
        <div class="max-w-7xl mx-auto px-6 py-6 flex items-center justify-between">
            <h1 class="serif text-[#0e380e] text-lg md:text-xl tracking-widest uppercase">Clarinbridge Publishing</h1>
            <div class="flex items-center space-x-2 text-[#C2B280]">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z"/></path></svg>
                <span class="text-[10px] font-bold tracking-[0.2em] uppercase text-gray-400">Secure Terminal</span>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-6 py-12 md:py-20">
        <div class="grid lg:grid-cols-12 gap-12 items-stretch">
            <div class="lg:col-span-7 flex flex-col">
                <div class="mb-4">
                    <div class="inline-flex items-center space-x-2 bg-[#C2B280]/10 px-3 py-1 rounded-full mb-6">
                        <div class="w-2 h-2 bg-[#C2B280] rounded-full animate-pulse"></div>
                        <span class="text-[10px] font-bold tracking-[0.2em] text-[#C2B280] uppercase">ISBN Registry Status: Pending Authorization</span>
                    </div>
                    <h2 class="serif text-2xl md:text-4xl mb-4 text-gray-900 leading-tight">Finalize Your Registration</h2>
                    <p class="text-gray-600 text-sm md:text-lg leading-relaxed mb-6">
                        You are now moving to our Secure Payment Terminal powered by Stripe. Your financial data is handled entirely within Stripe's PCI-compliant vault. Clarinbridge never sees or stores your card details.
                    </p>
                </div>

                <div class="relative group rounded-2xl overflow-hidden shadow-lg border border-gray-200 aspect-video bg-gray-100">
                    <img src="https://img.youtube.com/vi/vtHL5voLSnc/maxresdefault.jpg" class="w-full h-full object-cover opacity-80" alt="Review Process">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <div class="bg-[#0e380e] text-white p-3 rounded-full shadow-xl"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M4 2v20l18-10L4 2z"/></svg></div>
                        <p class="absolute bottom-4 text-white text-[10px] font-bold tracking-widest uppercase bg-black/40 px-3 py-1 rounded">Watch: The Review Process</p>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-5">
                <div class="bg-white px-8 py-8 rounded-2xl shadow-2xl border border-gray-50 relative overflow-hidden sync-box">
                    <div class="absolute top-0 left-0 w-full h-1 bg-[#C2B280]"></div>
                    <h3 class="serif text-2xl text-[#0e380e] tracking-tight">Summary</h3>
                    <div class="flex-grow flex flex-col justify-around py-4">
                        <div class="border-b border-gray-100 pb-2">
                            <p id="plan-name" class="font-bold text-gray-900 uppercase tracking-tight text-lg">ISBN Reservation</p>
                            <p class="text-[10px] text-gray-400 uppercase tracking-widest mt-1">Book Publishing Services</p>
                        </div>

                        <ul class="space-y-4 py-4">
                            <li class="flex items-start text-[13px] md:text-[15px] text-gray-700 font-semibold leading-tight whitespace-nowrap">
                                <span class="gold-text mr-3">✓</span> Official Bowker ISBN
                            </li>
                            <li class="flex items-start text-[13px] md:text-[15px] text-gray-700 font-semibold leading-tight whitespace-nowrap">
                                <span class="gold-text mr-3">✓</span> 100% Royalties & Copyright
                            </li>
                            <li class="flex items-start text-[13px] md:text-[15px] text-gray-700 font-semibold leading-tight whitespace-nowrap">
                                <span class="gold-text mr-3">✓</span> Founder Verification
                            </li>
                            <li class="flex items-start text-[13px] md:text-[15px] text-gray-700 font-semibold leading-tight whitespace-nowrap">
                                <span class="gold-text mr-3">✓</span> Universal Compatibility
                            </li>
                            <li class="flex items-start text-[13px] md:text-[15px] text-gray-700 font-semibold leading-tight whitespace-nowrap">
                                <span class="gold-text mr-3">✓</span> Meta Data Support
                            </li>
                        </ul>
                    </div>

                    <div class="mt-2">
                        <div class="pt-4 border-t border-gray-100 flex justify-between items-center mb-4">
                            <span class="font-bold uppercase tracking-widest text-[10px] text-gray-400">Total Authorization</span>
                            <span id="total-price" class="text-xl font-bold text-gray-900">$25.00</span>
                        </div>

                        <div class="space-y-3">
                            <button id="stripe-link" class="inline-block w-full bg-[#0e380e] text-white text-center py-4 rounded shadow-lg font-bold tracking-widest uppercase text-xs hover:bg-[#1a4a1a] transition-all transform hover:-translate-y-1">Authorize Payment</button>
                            
                            <div class="flex items-center justify-center space-x-2">
                                <svg class="w-3 h-3 text-[#C2B280]" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                </svg>
                                <img src="https://upload.wikimedia.org/wikipedia/commons/b/ba/Stripe_Logo%2C_revised_2016.svg" class="h-3.5" alt="Stripe">
                                <span class="text-gray-200">|</span>
                                <span class="text-[8px] font-bold tracking-widest uppercase text-gray-400">AES-256 ENCRYPTION</span>
                            </div>

                            <div class="bg-gray-50 p-3 rounded-lg border border-gray-100">
                                <p class="text-[9px] text-gray-500 leading-relaxed text-center uppercase tracking-widest">
                                    Payment is a <span class="text-[#0e380e] font-bold">Hold Only</span>. Funds are only captured if your book is accepted.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="mt-24 pt-12 pb-12 border-y border-[#C2B280]/30">
            <div class="max-w-4xl mx-auto flex flex-col md:flex-row items-center md:items-end justify-between text-center md:text-left gap-10">
                <div class="flex flex-col items-center md:items-start">
                    <h4 class="serif text-2xl text-[#0e380e] mb-2 tracking-tight leading-none">Questions before you authorize?</h4>
                    <p class="text-xs font-bold tracking-widest uppercase text-[#C2B280] leading-none">Personal Assistance</p>
                </div>
                <div class="flex flex-col md:flex-row items-center md:items-end gap-10 md:gap-16">
                    <div class="flex flex-col items-center md:items-start">
                        <p class="text-[9px] text-gray-400 font-bold tracking-[0.2em] uppercase mb-1">Direct Message Zack</p>
                        <a href="sms:+19728369225" class="text-[#0e380e] font-semibold text-base hover:text-[#C2B280] transition-colors leading-none">+1 (972) 836-9225</a>
                    </div>
                    <div class="flex flex-col items-center md:items-start">
                        <p class="text-[9px] text-gray-400 font-bold tracking-[0.2em] uppercase mb-1">Email</p>
                        <a href="mailto:zack@clarinbridgepublishing.com" class="text-[#0e380e] font-semibold text-base hover:text-[#C2B280] transition-colors leading-none">zack@clarinbridgepublishing.com</a>
                    </div>
                </div>
            </div>
        </footer>
    </main>

    <!-- ✅ Fixed Stripe Button Script -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const stripe = Stripe('pk_live_51SsoGeEK61VLMH4nczA0e00ZKdNrUoNy1GCgmWo7z7pqC8YQWQvwnNNA5SZLJp3y4ulv7kQ4nSsVVZKFwrJm6LpK00oDTDqwOB');
        const params = new URLSearchParams(window.location.search);
        const plan = params.get('plan');
        const planName = document.getElementById('plan-name');
        const totalPrice = document.getElementById('total-price');
        const stripeBtn = document.getElementById('stripe-link');

        let amountCents = 2500;
        let currentName = 'ISBN Reservation';

        if(plan === '2') {
            amountCents = 4500;
            currentName = '2x ISBN Reservations';
            totalPrice.innerText = '$45.00';
            planName.innerText = currentName;
        } else if(plan === '3') {
            amountCents = 5500;
            currentName = '3x ISBN Reservations';
            totalPrice.innerText = '$55.00';
            planName.innerText = currentName;
        }

        stripeBtn.addEventListener('click', async function(e) {
            e.preventDefault();
            stripeBtn.disabled = true; // prevent double clicks

            try {
                const response = await fetch('https://payment-hold-1.zazulak44.workers.dev', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ 
                        amount: amountCents,
                        description: currentName
                    })
                });

                if (!response.ok) {
                    const text = await response.text();
                    throw new Error('Worker returned an error: ' + text);
                }

                const data = await response.json();
                console.log('Worker response:', data);

                // ✅ Redirect to thank you page
                window.location.href = '/thank-you.html';
            } catch (error) {
                console.error('Error calling Worker:', error);
                alert('Something went wrong. Please try again.');
                stripeBtn.disabled = false; // re-enable if error
            }
        });
    });
    </script>
</body>
</html>
